(function(){"use strict";var e={4699:function(e,t,a){a.d(t,{H:function(){return s}});var r=a(144),n=a(6768),o=a(782);const l=(0,r.KR)(null);function s(){const e=(0,o.Pj)(),t=(0,n.EW)((()=>e.getters.amplifySound)),a=e=>{if(!l.value){const a=new AudioContext;l.value={context:a,source:a.createMediaElementSource(e),gain:a.createGain(),media:e,amplify:function(e){l.value.gain.gain.value=e}},l.value.source.connect(l.value.gain),l.value.gain.connect(a.destination),t.value&&r(2)}},r=async e=>{l.value&&l.value.amplify(e)};return{initializeAmplifier:a,changeLevel:r}}},3672:function(e,t,a){a.d(t,{g:function(){return o}});a(4114);var r=a(144);const n=(0,r.KR)([]);function o(){const e=e=>{n.value.push(e)},t=(t,a="",r=!1)=>{e({type:"success",message:t,title:a,persistOnce:r})},a=(t,a="",r=!1)=>{e({type:"info",message:t,title:a,persistOnce:r})},r=(t,a="",r=!1)=>{e({type:"warning",message:t,title:a,persistOnce:r})},o=(t,a="",r=!1)=>{e({type:"error",message:t,title:a,persistOnce:r})},l=e=>{n.value.splice(e,1)},s=()=>{const e=[];for(const t of n.value)t.persistOnce&&(t.persistOnce=!1,e.push(t));n.value=e};return{flashMessages:n,addSuccessMessage:t,addInfoMessage:a,addWarningMessage:r,addErrorMessage:o,clearMessage:l,clearAllMessages:s}}},8749:function(e,t,a){a.d(t,{B:function(){return l}});var r=a(144),n=a(2022),o=a(3672);function l(){const e=(0,r.KR)(null);let t=!1;const{addErrorMessage:a}=(0,o.g)(),l=async a=>{if(a)return null!==e.value||t||(t=!0,await s(a)),e.value;e.value=!1},s=async r=>{try{let t=await r.queryPermission({mode:n.kX});"granted"!==t&&(t=await r.requestPermission({mode:n.kX}),navigator.storage&&navigator.storage.persist&&await navigator.storage.persist()),e.value="granted"===t}catch(o){a("An error occurred on permission check"),console.error(o),e.value=!1}t=!1};return{permissionStatus:e,hasPermission:l}}},322:function(e,t,a){a.d(t,{o:function(){return c}});a(4114);var r=a(144),n=a(2022),o=a(782),l=a(3672),s=a(8976);const i=(0,r.KR)(null),u=(0,r.KR)({});function c(e){let t=!1;e||(e=(0,o.Pj)());const{addErrorMessage:a}=(0,l.g)(),r=async()=>(i.value||(i.value=await(0,s.W)().getLibraryHandle(),i.value&&await v(i.value)),i.value),c=async()=>{const e=[];if(!i.value)return e;try{for await(const[,t]of i.value.entries())"directory"===t.kind&&e.push(t)}catch(t){a("An error occurred on authors listing"),console.error(t)}return e},d=async e=>{const t=[];if(!e)return t;try{for await(const[,a]of e.entries())"directory"===a.kind&&t.push(a)}catch(r){a("An error occurred on books listing for author "+e.name),console.error(r)}return t},p=async e=>{const t=[];if(!e)return t;try{for await(const[a,r]of e.entries())if("file"===r.kind){const o=a.slice(a.lastIndexOf("."));n.HA.includes(o)?t.push(r):console.log("File extension not supported for file "+e.name+"/"+a)}}catch(r){a("An error occurred on chapters listing for book "+e.name),console.error(r)}return t},v=async a=>{t=!0,i.value=a,u.value={};const r=await c();for(const e of r){const t={},a=await d(e);for(const e of a)t[e.name]=await p(e);u.value[e.name]=t}await e.dispatch("selectLibrary",a.name),await(0,s.W)().setLibraryHandle(a),t=!1},f=()=>Object.keys(u.value),C=e=>u.value[e]?Object.keys(u.value[e]):[],h=(e,t)=>u.value[e]&&u.value[e][t]?u.value[e][t]:[],m=(e,t,a)=>{const r=h(e,t);return r[a]?r[a]:null};return{libraryHandle:i,getLibraryHandle:r,tracks:u,loadLibrary:v,getAuthorsList:f,getBooksFromAuthor:C,getChaptersFromBook:h,getChapterFromBook:m,isLoading:t}}},8976:function(e,t,a){a.d(t,{W:function(){return s}});var r=a(144),n=a(1373),o=a.n(n),l=a(2022);function s(){const e=(0,r.KR)(null),t=()=>(e.value||(e.value=o().createInstance({name:l.Y3,storeName:"application-data"})),e.value),a=async()=>{const e=t();return await e.getItem("libraryHandle")},n=async e=>{const a=t();return await a.setItem("libraryHandle",e)};return{getStorageInstance:t,getLibraryHandle:a,setLibraryHandle:n}}},2022:function(e,t,a){a.d(t,{HA:function(){return n},Y3:function(){return o},kX:function(){return r}});const r="read",n=[".mp3"],o="keiwen-fable-flow"},5351:function(e,t,a){var r=a(5130),n=a(6768),o=a(4232),l=a(144),s=a(3672);const i={class:"nav-item"},u={class:"nav-item","aria-label":"Navigate to chapter page"},c={class:"nav-item","aria-label":"Navigate to settings"};function d(e,t){const a=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("nav",null,[(0,n.Lk)("div",i,[(0,n.bF)(a,{to:"/book","aria-label":"Navigate to book selection"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("Book")]))),_:1})]),(0,n.Lk)("div",u,[(0,n.bF)(a,{to:"/"},{default:(0,n.k6)((()=>t[1]||(t[1]=[(0,n.eW)("Chapter")]))),_:1})]),(0,n.Lk)("div",c,[(0,n.bF)(a,{to:"/settings"},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("Settings")]))),_:1})])])}var p=a(1241);const v={},f=(0,p.A)(v,[["render",d]]);var C=f,h=a(782);const m={class:"message-container"},g=["onClick"];var y={__name:"App",setup(e){const{flashMessages:t,clearMessage:a}=(0,s.g)(),r=(0,h.Pj)(),i=(0,n.EW)((()=>t.value)),u=(0,n.EW)((()=>r.getters.theme)),c=e=>{switch(e){case"error":return"alert-danger";default:return"alert-"+e}};return(e,t)=>{const r=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.CE)("div",{class:(0,o.C4)("theme-"+u.value)},[(0,n.bF)((0,l.R1)(C)),(0,n.Lk)("div",m,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.value,((e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:(0,o.C4)(["alert",c(e.type)]),onClick:e=>(0,l.R1)(a)(t)},(0,o.v_)(e.message),11,g)))),128))]),(0,n.bF)(r,{class:"content"})],2)}}};const k=y;var b=k,w=a(4458);(0,w.k)("service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var E=a(1387),L=a(322),A={__name:"ChapterInfo",setup(e){const t=(0,h.Pj)(),{getChapterFromBook:a}=(0,L.o)(),r=(0,n.EW)((()=>t.getters.author)),l=(0,n.EW)((()=>t.getters.book)),s=(0,n.EW)((()=>t.getters.getChapterIndex())),i=(0,n.EW)((()=>a(r.value,l.value,s.value)));return(e,t)=>((0,n.uX)(),(0,n.CE)("div",null,[(0,n.Lk)("p",null,(0,o.v_)(i.value?i.value.name:""),1)]))}};const T=A;var P=T;a(4603),a(7566),a(8721);function S(){const e=(e,t,a)=>{if("mediaSession"in navigator){const r={artist:e,album:t,title:a};navigator.mediaSession.metadata=new MediaMetadata(r)}navigator.mediaSession.setActionHandler("previoustrack",(function(){B().trackTimeBack()})),navigator.mediaSession.setActionHandler("nexttrack",(function(){B().nextChapter()}))};return{setup:e}}var R=a(4699);const x=(0,l.KR)(null);function B(){const e=(0,h.Pj)(),{getChapterFromBook:t}=(0,L.o)(),{addWarningMessage:a,addErrorMessage:r}=(0,s.g)(),o=(0,l.KR)(null),i=(0,l.KR)(0),u=(0,l.KR)(0),c=(0,l.KR)(0),d=(0,l.KR)(0),p=(0,l.KR)(!1),v=(0,n.EW)((()=>e.getters.author)),f=(0,n.EW)((()=>e.getters.book)),C=(0,n.EW)((()=>e.getters.getChapterIndex())),m=(0,n.EW)((()=>t(v.value,f.value,C.value))),g=(0,n.EW)((()=>e.getters.autoplayNextChapter)),y=(0,n.EW)((()=>e.getters.displayChapterTitle)),k=(0,n.EW)((()=>e.getters.autoRewindOnPause)),b=async t=>{if(x.value=t,x.value.addEventListener("timeupdate",O),x.value.addEventListener("loadedmetadata",j),x.value.addEventListener("pause",M),x.value.addEventListener("play",W),x.value.addEventListener("ended",F),x.value.addEventListener("error",N),(0,R.H)().initializeAmplifier(x.value),m.value){await E(m.value,!1);const t=e.getters.getTrackTime();t&&(i.value=t)}},w=async()=>{x.value&&(await x.value.pause(),c.value=0,d.value=0,p.value=!1)},E=async(e,t=!0)=>{if(x.value)if(e)try{const a=await e.getFile();o.value&&URL.revokeObjectURL(o.value),o.value=URL.createObjectURL(a),await x.value.load();const r=y.value?m.value.name:"Chapter "+C.value;S().setup(v.value,f.value,r),t&&(await x.value.play(),p.value=!0)}catch(a){r("Cannot start audio file"),console.error(a)}else r("No chapter found")},A=async()=>{if(!x.value)return;i.value=0;const r=C.value+1,n=t(v.value,f.value,r);n?(await w(),await e.dispatch("selectChapterIndex",r),await E(n)):a("This is the last chapter")},T=async()=>{x.value&&(i.value=0,await w(),await e.dispatch("selectChapterIndex",0),E(m.value))},P=e=>{x.value&&(e||(e=10),x.value.currentTime-=e)},B=e=>{x.value&&(x.value.currentTime=parseInt(e)/100*x.value.duration)},_=()=>{x.value&&(x.value.paused?x.value.play():x.value.pause(),p.value=!p.value)},O=e=>{x.value&&(c.value=Math.floor(x.value.currentTime),d.value=Math.round(x.value.currentTime/x.value.duration*100))},M=e=>{p.value=!1,k.value&&x.value.currentTime!==x.value.duration&&P()},W=e=>{p.value=!0},F=e=>{p.value=!1,g.value&&A()},N=e=>{p.value=!1,r("An error occurred on audio player"),console.error(e)},j=e=>{x.value&&(u.value=x.value.duration,x.value.currentTime=i.value)};return(0,n.wB)(c,((t,a)=>{t!==a&&e.dispatch("updateTrackTime",t)})),{chapterSrc:o,initTrackTime:i,duration:u,currentTime:c,currentProgress:d,playing:p,initializeAudioPlayer:b,stopAudio:w,playChapter:E,nextChapter:A,startBook:T,trackTimeBack:P,changeProgress:B,togglePlay:_}}const _=["aria-label"],O={id:"play",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 100 100","xml:space":"preserve"},M=["stroke"],W=["stroke"],F=["fill"],N=["fill"];var j={__name:"AudioPlayerPlayButton",props:{playing:{type:Boolean,default:!1},color:{type:String,default:"white"}},emits:["click-play"],setup(e,{emit:t}){const a=e,r=t,l=(0,n.EW)((()=>{let e="play-button";return a.playing&&(e+=" play-button-playing"),e})),s=()=>{r("click-play")};return(t,a)=>((0,n.uX)(),(0,n.CE)("div",{class:(0,o.C4)(l.value),onClick:a[0]||(a[0]=e=>s()),role:"button","aria-label":e.playing?"Pause track":"Play track"},[((0,n.uX)(),(0,n.CE)("svg",O,[(0,n.Lk)("path",{class:"play-border play-border-solid",fill:"none",stroke:e.color,d:"M49.9,2.5C23.6,2.8,2.1,24.4,2.5,50.4C2.9,76.5,24.7,98,50.3,97.5c26.4-0.6,47.4-21.8,47.2-47.7 C97.3,23.7,75.7,2.3,49.9,2.5"},null,8,M),(0,n.Lk)("path",{class:"play-border play-border-dotted",fill:"none",stroke:e.color,d:"M49.9,2.5C23.6,2.8,2.1,24.4,2.5,50.4C2.9,76.5,24.7,98,50.3,97.5c26.4-0.6,47.4-21.8,47.2-47.7 C97.3,23.7,75.7,2.3,49.9,2.5"},null,8,W),(0,n.Lk)("path",{class:"play-icon",fill:e.color,d:"M38,69c-1,0.5-1.8,0-1.8-1.1V32.1c0-1.1,0.8-1.6,1.8-1.1l34,18c1,0.5,1,1.4,0,1.9L38,69z"},null,8,F),(0,n.Lk)("path",{class:"pause-icon",fill:e.color,d:"M37.5 21.875a3.125 3.125 0 0 1 3.125 3.125v50a3.125 3.125 0 0 1 -6.25 0V25a3.125 3.125 0 0 1 3.125 -3.125zm25 0a3.125 3.125 0 0 1 3.125 3.125v50a3.125 3.125 0 0 1 -6.25 0V25a3.125 3.125 0 0 1 3.125 -3.125z"},null,8,N)]))],10,_))}};const I=j;var X=I;const K={id:"rewind",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 512 512","xml:space":"preserve"},H=["fill"],V=["fill"],z=["fill"];var U={__name:"AudioPlayerRewindButton",props:{color:{type:String,default:"white"}},emits:["click-rewind"],setup(e,{emit:t}){const a=t,r=()=>{a("click-rewind")};return(t,a)=>((0,n.uX)(),(0,n.CE)("div",{class:"rewind-button",onClick:a[0]||(a[0]=e=>r()),role:"button","aria-label":"Rewind track"},[((0,n.uX)(),(0,n.CE)("svg",K,[(0,n.Lk)("path",{class:"rewind-border",fill:e.color,transform:"translate(294.3125,42.1875)",d:"M0 0 C3.9323173 2.65202795 6.18648186 5.30944559 7.6875 9.8125 C8.18891155 14.58823948 8.28755298 18.56238963 6.1875 22.9375 C3.39784526 26.14560295 0.46485501 29.13881691 -2.60546875 32.078125 C-4.3925373 33.71534106 -4.3925373 33.71534106 -5.3125 35.8125 C-4.30304321 35.87618774 -4.30304321 35.87618774 -3.27319336 35.94116211 C3.43348713 36.44548956 9.65624623 37.55734835 16.125 39.375 C17.54171997 39.76981567 17.54171997 39.76981567 18.98706055 40.17260742 C48.20303374 48.5872171 78.13691957 64.01276119 99.25 86.33984375 C100.87130756 88.05722558 100.87130756 88.05722558 103.6875 90.25 C107.46037575 93.4726647 110.52259626 97.00049698 113.6875 100.8125 C114.11836914 101.32039063 114.54923828 101.82828125 114.99316406 102.3515625 C148.66178099 142.1522643 164.98801867 194.12431188 161.46923828 246.03222656 C157.70522811 289.30842083 141.20369088 329.02983141 112.6875 361.8125 C112.18750488 362.39225586 111.68750977 362.97201172 111.17236328 363.56933594 C81.74366789 397.43222645 39.73416298 419.4597025 -4.3125 426.8125 C-5.58738281 427.03679687 -6.86226562 427.26109375 -8.17578125 427.4921875 C-59.41046454 435.01004053 -112.70647676 421.36373081 -154.3125 390.8125 C-158.1083124 387.95982909 -161.74232538 384.94282911 -165.3125 381.8125 C-166.14910156 381.08546875 -166.98570312 380.3584375 -167.84765625 379.609375 C-183.18213614 366.05246233 -195.47535333 351.11625683 -206.3125 333.8125 C-206.69116211 333.21308594 -207.06982422 332.61367188 -207.45996094 331.99609375 C-219.26305646 313.03743555 -226.70376017 291.57665187 -231.3125 269.8125 C-231.48894043 269.00055176 -231.66538086 268.18860352 -231.84716797 267.35205078 C-236.78687192 243.49558165 -236.51703374 215.58594972 -231.3125 191.8125 C-231.11382324 190.89791016 -230.91514648 189.98332031 -230.71044922 189.04101562 C-222.60061042 152.95678904 -205.33905654 120.93120693 -180.3125 93.8125 C-179.61108887 93.05114746 -179.61108887 93.05114746 -178.89550781 92.27441406 C-173.6426276 86.64335672 -168.02166641 81.59429491 -162 76.8125 C-161.42515869 76.35520508 -160.85031738 75.89791016 -160.25805664 75.42675781 C-154.84304777 71.24046997 -150.18039961 68.21496745 -143.26171875 68.53125 C-138.18904793 69.26317845 -134.38988307 71.90219846 -131.296875 75.94921875 C-128.97189998 80.35006431 -128.69937541 85.14589465 -129.8046875 89.953125 C-132.03053029 95.33754469 -136.03105669 98.31736393 -140.59375 101.74609375 C-145.08345729 105.15852932 -149.18338571 108.97783333 -153.3125 112.8125 C-153.95574219 113.39 -154.59898437 113.9675 -155.26171875 114.5625 C-181.04797457 138.78103796 -196.91853739 175.06953985 -201.3125 209.8125 C-201.42335937 210.6271875 -201.53421875 211.441875 -201.6484375 212.28125 C-205.62276126 247.08343643 -197.88141364 281.22197107 -181.3125 311.8125 C-180.97379883 312.4401123 -180.63509766 313.06772461 -180.28613281 313.71435547 C-160.38871664 350.00399247 -124.95716992 378.03781091 -85.31005859 389.6953125 C-38.72347002 402.55277657 6.9928526 397.11445072 49.15087891 373.29833984 C54.99318441 369.87617707 60.4172388 366.05581772 65.6875 361.8125 C66.55012451 361.12486572 66.55012451 361.12486572 67.43017578 360.42333984 C101.85357454 332.7139573 123.22413658 292.60008993 128.6875 248.8125 C130.88471415 198.27657464 118.0675561 153.78827952 83.5625 115.8125 C78.36615118 110.25585746 72.77284726 105.38677588 66.6875 100.8125 C65.90318604 100.21574463 65.90318604 100.21574463 65.10302734 99.60693359 C44.0336965 83.66341575 21.25752183 74.12052301 -4.3125 67.8125 C-1.27623145 71.65978068 1.90487383 75.3194168 5.19921875 78.9453125 C8.61099507 83.22570378 8.25601046 88.6090501 7.6875 93.8125 C6.42402588 97.51365518 4.48780847 100.12652131 1.5 102.6875 C-3.60141859 104.72806744 -8.05692203 105.50717549 -13.3684082 103.87133789 C-18.864441 101.42841875 -22.73900005 96.91683182 -26.89453125 92.69140625 C-28.23761604 91.34694679 -28.23761604 91.34694679 -29.60783386 89.97532654 C-31.49276313 88.08437023 -33.37343837 86.19015109 -35.24780273 84.28881836 C-37.64613905 81.85640666 -40.05752916 79.43746704 -42.47371387 77.02279758 C-44.78626496 74.70957127 -47.09027223 72.38788835 -49.39453125 70.06640625 C-50.25907425 69.1996376 -51.12361725 68.33286896 -52.01435852 67.43983459 C-52.81246445 66.62896896 -53.61057037 65.81810333 -54.43286133 64.98266602 C-55.48707024 63.91702171 -55.48707024 63.91702171 -56.56257629 62.82984924 C-59.57001149 59.36281403 -60.61557621 56.56716037 -60.6875 52 C-60.71585938 51.18917969 -60.74421875 50.37835938 -60.7734375 49.54296875 C-59.44114049 41.65080254 -53.24965982 36.3095787 -47.8203125 30.921875 C-46.99675262 30.09544495 -46.17319275 29.26901489 -45.32467651 28.4175415 C-43.5884635 26.67929422 -41.84848506 24.94480075 -40.10498047 23.21386719 C-37.44275658 20.56772483 -34.79693515 17.90593905 -32.15234375 15.2421875 C-30.45929455 13.55112044 -28.76531512 11.86098408 -27.0703125 10.171875 C-25.88878098 8.98123444 -25.88878098 8.98123444 -24.68338013 7.76654053 C-17.2205209 0.39810206 -10.43755754 -3.74176591 0 0 Z "},null,8,H),(0,n.Lk)("path",{class:"rewind-icon rewind-icon-1",fill:e.color,transform:"translate(200.375,171)",d:"M0 0 C4.52460109 3.44731512 8.80303354 7.53410061 10.625 13 C10.72381789 15.32196798 10.76004615 17.64673118 10.76544189 19.97079468 C10.76841302 20.68445179 10.77138414 21.39810889 10.7744453 22.13339198 C10.78313458 24.53083432 10.78464073 26.92822674 10.78613281 29.32568359 C10.79076078 31.0421306 10.79578541 32.75857658 10.80117798 34.47502136 C10.814305 39.14238556 10.82074739 43.80973538 10.82518864 48.47711515 C10.82811854 51.39200885 10.83222316 54.3068986 10.83669281 57.22179031 C10.85036779 66.33874696 10.86003476 75.45569461 10.8638947 84.5726608 C10.86837728 95.10281164 10.88593444 105.6328328 10.9148953 116.1629442 C10.93649624 124.29889931 10.94659811 132.43481789 10.94793582 140.57080138 C10.94898488 145.43183794 10.95491421 150.29275259 10.97275543 155.153759 C10.98920895 159.72560068 10.99140489 164.29722844 10.98261642 168.86908913 C10.98184462 170.547282 10.98620761 172.22548624 10.99607468 173.90365028 C11.00875418 176.19443546 11.00293971 178.4844584 10.99249268 180.77523804 C10.99469252 182.69824517 10.99469252 182.69824517 10.9969368 184.66010094 C10.43808144 189.67848171 8.4254312 192.16145303 5 195.75 C1.21320277 198.70257705 -2.635521 199.40899057 -7.375 199 C-12.71234929 197.39032323 -16.34161327 194.7320833 -19.375 190 C-20.43414546 186.82256362 -20.49820043 184.58608213 -20.49525452 181.24836731 C-20.49662918 180.04943344 -20.49800385 178.85049957 -20.49942017 177.61523438 C-20.49402725 175.63970581 -20.49402725 175.63970581 -20.48852539 173.62426758 C-20.48824335 172.2248281 -20.48840159 170.82538848 -20.4889679 169.4259491 C-20.48925521 165.62458216 -20.48336915 161.82324668 -20.47639394 158.02188706 C-20.4701494 154.05004933 -20.46955573 150.0782109 -20.46836853 146.10636902 C-20.46525847 138.58411051 -20.45704944 131.0618665 -20.44701904 123.53961438 C-20.43584783 114.97622727 -20.43034491 106.41283947 -20.42532361 97.84944689 C-20.41486657 80.23295637 -20.3972734 62.61647935 -20.375 45 C-20.92567139 45.48283447 -21.47634277 45.96566895 -22.04370117 46.46313477 C-22.76533447 47.09533936 -23.48696777 47.72754395 -24.23046875 48.37890625 C-24.94614014 49.00611572 -25.66181152 49.6333252 -26.39916992 50.27954102 C-31.48408288 54.7072417 -35.01179988 55.55499476 -41.71875 55.34765625 C-46.85748313 54.67508677 -49.39295599 52.08541707 -52.75 48.375 C-54.91261618 43.88341255 -55.35324978 39.89844192 -54.375 35 C-51.66685939 29.23940751 -48.15378256 25.51204518 -43.4375 21.3125 C-42.09624026 20.09387536 -40.75509665 18.87512289 -39.4140625 17.65625 C-38.74020508 17.04910156 -38.06634766 16.44195312 -37.37207031 15.81640625 C-35.46107402 14.07828737 -33.58129248 12.31292875 -31.7109375 10.53125 C-31.13722412 9.98815186 -30.56351074 9.44505371 -29.97241211 8.88549805 C-28.89867345 7.86798103 -27.82888678 6.84627032 -26.76391602 5.81958008 C-18.93681227 -1.51905274 -10.27029952 -3.04305171 0 0 Z "},null,8,V),(0,n.Lk)("path",{class:"rewind-icon rewind-icon-2",fill:e.color,transform:"translate(335.84375,188.00390625)",d:"M0 0 C11.45628394 10.6053643 18.43321768 22.39796314 19.2750721 38.23079109 C19.47992811 44.82406988 19.46202699 51.41982909 19.45703125 58.015625 C19.46092559 60.16354962 19.46526176 62.31147348 19.47001648 64.45939636 C19.4774509 68.94862368 19.47720782 73.43777232 19.47192383 77.92700195 C19.46613577 83.64591011 19.483058 89.3644937 19.5062685 95.08334827 C19.5210864 99.51635076 19.52186658 103.94927655 19.51875877 108.38229942 C19.51926803 110.48916961 19.52443048 112.59604455 19.53457069 114.7028904 C19.61828644 134.52808728 18.24431896 151.49646884 4.21875 166.80859375 C-6.27183616 176.66513349 -19.15075121 181.9394571 -33.53125 182.015625 C-48.38029808 181.46177946 -62.45559772 175.92452818 -72.84375 164.99609375 C-82.49980626 153.54647196 -85.98691521 140.82259631 -86.00488281 126.14208984 C-86.01233017 124.67739258 -86.01233017 124.67739258 -86.01992798 123.18310547 C-86.03449725 119.9619068 -86.0413437 116.74075742 -86.046875 113.51953125 C-86.05263176 111.26998901 -86.05838942 109.02044678 -86.06414795 106.77090454 C-86.07464376 102.05511243 -86.08049539 97.3393373 -86.08398438 92.62353516 C-86.08945908 86.60500495 -86.11347144 80.58670211 -86.14195633 74.56824303 C-86.16065813 69.92000695 -86.16579237 65.27182474 -86.16732025 60.62355423 C-86.17033145 58.40617254 -86.17830764 56.18879145 -86.19150543 53.97144699 C-86.29774877 34.74584666 -84.79415229 17.60577781 -70.84375 2.99609375 C-50.90084568 -14.4578857 -21.01968341 -17.70679852 0 0 Z M-50.84375 28.24609375 C-54.75923274 34.88513239 -55.14185055 42.41441332 -55.10253906 49.953125 C-55.1060437 50.79829681 -55.10954834 51.64346863 -55.11315918 52.51425171 C-55.1218868 55.27911854 -55.11615929 58.04372479 -55.109375 60.80859375 C-55.11072423 62.74715219 -55.11266691 64.68571029 -55.11517334 66.62426758 C-55.11811246 70.67565145 -55.11386606 74.72694678 -55.10449219 78.77832031 C-55.09309843 83.95291697 -55.0996644 89.12730609 -55.11163712 94.30189514 C-55.1188885 98.30148868 -55.11655276 102.3010336 -55.11138153 106.30062866 C-55.1100541 108.20787582 -55.11166075 110.1151275 -55.11634064 112.02236938 C-55.12145999 114.6947182 -55.11362028 117.36673798 -55.10253906 120.0390625 C-55.10658752 120.8154306 -55.11063599 121.59179871 -55.11480713 122.39169312 C-55.04473322 131.58401374 -53.55965557 139.36993302 -46.84375 145.99609375 C-41.94956032 149.797926 -36.77869969 150.76360547 -30.65625 150.5 C-24.95686937 149.47886097 -19.94137217 146.95903007 -16.54920387 142.16751957 C-13.01462264 136.28035009 -12.11942315 131.7248748 -12.19677734 124.92163086 C-12.18801575 123.95780991 -12.17925415 122.99398895 -12.17022705 122.0009613 C-12.14836895 118.84131751 -12.16273671 115.68309345 -12.1796875 112.5234375 C-12.17631575 110.31343825 -12.17146015 108.10344081 -12.16519165 105.89344788 C-12.15783893 101.27277893 -12.16847563 96.65259481 -12.19189453 92.03198242 C-12.22039749 86.12158898 -12.20395764 80.2123301 -12.17403221 74.30197811 C-12.15593053 69.74218761 -12.16173027 65.1826644 -12.17467117 60.62286568 C-12.17799635 58.44405545 -12.17394952 56.26522061 -12.16227341 54.08643913 C-12.14951593 51.03736306 -12.16901052 47.99010352 -12.19677734 44.94116211 C-12.18665619 44.04898987 -12.17653503 43.15681763 -12.16610718 42.23760986 C-12.28302921 35.27653165 -14.47260122 30.47930352 -19.32169151 25.4690237 C-24.29280579 21.06662137 -28.82401901 19.44621362 -35.37109375 19.62109375 C-41.41505234 20.53771306 -47.02325729 23.42553089 -50.84375 28.24609375 Z "},null,8,z)]))]))}};const q=U;var D=q;function Z(){const e=e=>e?(e=e.toString(),e.charAt(0).toUpperCase()+e.slice(1)):"",t=e=>{let t=0,a=0,r=0,n=Math.floor(e);n>=60&&(r=n/60,a=Math.floor(r),n=Math.round(60*(r-a))),a>=60&&(r=a/60,t=Math.floor(r),a=Math.round(60*(r-t))),n<10&&(n="0"+n),a<10&&(a="0"+a);let o=a+":"+n;return t>0&&(o=t+":"+o),o};return{capitalize:e,time:t}}const Y={class:"custom-player-time"},G={class:"custom-player-current-time"},Q={class:"custom-player-duration"};var $={__name:"AudioPlayerTimeview",props:{duration:{type:Number,default:0},currentTime:{type:Number,default:0}},setup(e){const{time:t}=Z(),a=e=>t(e);return(t,r)=>((0,n.uX)(),(0,n.CE)("div",Y,[(0,n.Lk)("span",G,(0,o.v_)(a(e.currentTime)),1),r[0]||(r[0]=(0,n.eW)(" / ")),(0,n.Lk)("span",Q,(0,o.v_)(a(e.duration)),1)]))}};const J=$;var ee=J;const te=["value"];var ae={__name:"AudioPlayerTimeline",props:{percentProgress:{type:Number,required:!0}},emits:["changeProgress"],setup(e,{emit:t}){const a=e,r=t,l=(0,n.EW)((()=>({"--custom-player-percent-progress":a.percentProgress+"%"}))),s=e=>{r("changeProgress",e.srcElement.value)};return(t,a)=>((0,n.uX)(),(0,n.CE)("div",{class:"custom-player-timeline",style:(0,o.Tr)(l.value)},[(0,n.Lk)("input",{type:"range",max:"100",value:e.percentProgress,onChange:s,"aria-label":"Player timeline"},null,40,te)],4))}};const re=ae;var ne=re;const oe={class:"audio-player"},le=["src"],se={class:"chapter-control-container"},ie={class:"custom-player-container"};var ue={__name:"AudioPlayer",setup(e){const{addErrorMessage:t}=(0,s.g)(),a=(0,l.KR)(null),r=B(),o=r.playing,i=r.currentProgress,u=r.duration,c=r.currentTime;return(0,n.sV)((async()=>{a.value?r.initializeAudioPlayer(a.value):t("Cannot initialize audio player")})),(e,t)=>((0,n.uX)(),(0,n.CE)("div",null,[(0,n.Lk)("div",oe,[(0,n.Lk)("audio",{controls:"",ref_key:"audioPlayer",ref:a},[(0,n.Lk)("source",{src:(0,l.R1)(r).chapterSrc.value},null,8,le)],512)]),(0,n.Lk)("div",se,[(0,n.Lk)("div",null,[(0,n.Lk)("button",{class:"btn-warning",onClick:t[0]||(t[0]=(...e)=>(0,l.R1)(r).startBook&&(0,l.R1)(r).startBook(...e))},"Start book over")]),(0,n.Lk)("div",ie,[(0,n.bF)((0,l.R1)(X),{playing:(0,l.R1)(o),color:"var(--primary)",onClickPlay:(0,l.R1)(r).togglePlay},null,8,["playing","onClickPlay"]),(0,n.bF)((0,l.R1)(ne),{"percent-progress":(0,l.R1)(i),onChangeProgress:(0,l.R1)(r).changeProgress},null,8,["percent-progress","onChangeProgress"]),(0,n.bF)((0,l.R1)(ee),{duration:(0,l.R1)(u),"current-time":(0,l.R1)(c)},null,8,["duration","current-time"]),(0,n.bF)((0,l.R1)(D),{color:"var(--primary)",onClickRewind:t[1]||(t[1]=e=>(0,l.R1)(r).trackTimeBack())})]),(0,n.Lk)("div",null,[(0,n.Lk)("button",{class:"btn-secondary",onClick:t[2]||(t[2]=(...e)=>(0,l.R1)(r).nextChapter&&(0,l.R1)(r).nextChapter(...e))},"Next chapter")])])]))}};const ce=(0,p.A)(ue,[["__scopeId","data-v-bbf0f30a"]]);var de=ce,pe={__name:"BookInfo",setup(e){const t=(0,h.Pj)(),{getChaptersFromBook:a}=(0,L.o)(),r=(0,n.EW)((()=>t.getters.author)),l=(0,n.EW)((()=>t.getters.book)),s=(0,n.EW)((()=>a(r.value,l.value))),i=(0,n.EW)((()=>s.value.length));return(e,t)=>((0,n.uX)(),(0,n.CE)("div",null,[(0,n.Lk)("p",null,(0,o.v_)(r.value)+": "+(0,o.v_)(l.value)+" ("+(0,o.v_)(i.value)+" chapters) ",1)]))}};const ve=pe;var fe=ve,Ce={__name:"ChapterPlayView",setup(e){const t=(0,h.Pj)(),a=(0,n.EW)((()=>t.getters.displayChapterTitle));return(e,t)=>((0,n.uX)(),(0,n.CE)("div",null,[t[0]||(t[0]=(0,n.Lk)("h1",null,"Chapter play",-1)),(0,n.bF)((0,l.R1)(fe)),(0,n.bF)((0,l.R1)(de)),a.value?((0,n.uX)(),(0,n.Wv)((0,l.R1)(P),{key:0})):(0,n.Q3)("",!0)]))}};const he=Ce;var me=he;const ge=["value"];var ye={__name:"AuthorSelect",setup(e){const t=(0,h.Pj)(),{getAuthorsList:a}=(0,L.o)(),s=(0,l.KR)(""),i=(0,n.EW)((()=>a()));return(0,n.wB)(s,(async e=>{e&&e!==t.getters.author&&t.dispatch("selectAuthor",e)})),(0,n.sV)((async()=>{s.value=t.getters.author})),(e,t)=>((0,n.uX)(),(0,n.CE)("div",null,[t[2]||(t[2]=(0,n.Lk)("label",{for:"authorSelect"},"Author:",-1)),(0,n.bo)((0,n.Lk)("select",{id:"authorSelect","onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),class:(0,o.C4)(s.value?"":"empty-select")},[t[1]||(t[1]=(0,n.Lk)("option",{value:"",class:"placeholder",disabled:"",selected:"",hidden:""},"Select author...",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.value,(e=>((0,n.uX)(),(0,n.CE)("option",{key:e,value:e},(0,o.v_)(e),9,ge)))),128))],2),[[r.u1,s.value]])]))}};const ke=ye;var be=ke;a(4114);const we=["value"];var Ee={__name:"BookSelect",setup(e){const t=(0,h.Pj)(),{getBooksFromAuthor:a}=(0,L.o)(),s=(0,E.rd)(),i=(0,l.KR)(""),u=(0,n.EW)((()=>t.getters.author)),c=(0,n.EW)((()=>a(u.value)));return(0,n.wB)(u,(async e=>{e&&(i.value=t.getters.book)})),(0,n.wB)(i,(async e=>{e&&e!==t.getters.book&&(await t.dispatch("selectBook",e),s.push({name:"chapter"}))})),(0,n.sV)((async()=>{i.value=t.getters.book})),(e,t)=>((0,n.uX)(),(0,n.CE)("div",null,[t[2]||(t[2]=(0,n.Lk)("label",{for:"bookSelect"},"Book:",-1)),(0,n.bo)((0,n.Lk)("select",{id:"bookSelect","onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),class:(0,o.C4)(i.value?"":"empty-select")},[t[1]||(t[1]=(0,n.Lk)("option",{value:"",class:"placeholder",disabled:"",selected:"",hidden:""},"Select book...",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.value,(e=>((0,n.uX)(),(0,n.CE)("option",{key:e,value:e},(0,o.v_)(e),9,we)))),128))],2),[[r.u1,i.value]])]))}};const Le=Ee;var Ae=Le,Te={__name:"BookSelectionView",setup(e){return(e,t)=>((0,n.uX)(),(0,n.CE)("div",null,[t[0]||(t[0]=(0,n.Lk)("h1",null,"Book selection",-1)),(0,n.bF)((0,l.R1)(be),{class:"selection selection-author"}),(0,n.bF)((0,l.R1)(Ae),{class:"selection selection-book"})]))}};const Pe=Te;var Se=Pe;const Re=[{path:"/",name:"chapter",component:me},{path:"/book",name:"book",component:Se},{path:"/settings",name:"settings",component:()=>a.e(594).then(a.bind(a,4568))},{path:"/setup",name:"setup",component:()=>a.e(594).then(a.bind(a,7204))}],xe=(0,E.aE)({history:(0,E.Bt)(),routes:Re});var Be=xe,_e=a(4664),Oe=a(8976);const Me=new _e.Ay({storage:(0,Oe.W)().getStorageInstance(),asyncStorage:!0,key:"store"});var We=(0,h.y$)({state:{library:"",author:"",book:"",shelf:{},amplifySound:!1,autoplayNextChapter:!1,displayChapterTitle:!0,autoRewindOnPause:!1,theme:"dark"},getters:{author:e=>e.author,book:e=>e.book,amplifySound:e=>e.amplifySound,autoplayNextChapter:e=>e.autoplayNextChapter,displayChapterTitle:e=>e.displayChapterTitle,autoRewindOnPause:e=>e.autoRewindOnPause,theme:e=>e.theme,shelf:e=>e.shelf,getBookOnShelf:(e,t)=>(a,r)=>{if(a||(a=t.author),!a)return null;if(r||(r=t.book),!r)return null;const n=e.shelf[a];return n?n[r]??null:null},getChapterIndex:(e,t)=>(e,a)=>{const r=t.getBookOnShelf(e,a);return r?r.chapterIndex??0:0},getTrackTime:(e,t)=>(e,a)=>{const r=t.getBookOnShelf(e,a);return r?r.trackTime??0:0}},mutations:{setLibrary(e,t){e.library=t},setAuthor(e,t){e.author=t},setBook(e,t){e.book=t},setChapterIndex(e,t){const a=e.shelf[e.author][e.book];a.chapterIndex=t},setTrackTime(e,t){const a=e.shelf[e.author][e.book];a.trackTime=t},setAmplifySound(e,t){e.amplifySound=t},setAutoplayNextChapter(e,t){e.autoplayNextChapter=t},setDisplayChapterTitle(e,t){e.displayChapterTitle=t},setAutoRewindOnPause(e,t){e.autoRewindOnPause=t},setTheme(e,t){console.log("commiting",t),e.theme=t},addBookOnShelf(e,t){e.shelf[t.author]||(e.shelf[t.author]={}),e.shelf[t.author][t.book]={chapterIndex:0,trackTime:0}},resetSelection(e){e.author="",e.book=""}},actions:{selectLibrary({state:e,commit:t},a){a?a!==e.library&&(t("setLibrary",a),t("resetSelection")):(t("setLibrary",""),t("resetSelection"))},selectAuthor({commit:e},t){e("setBook",""),e("setAuthor",t)},selectBook({getters:e,dispatch:t,commit:a},r){a("setBook",r);const n=e.getBookOnShelf(e.author,r);n||t("addBookOnShelf")},selectChapterIndex({commit:e},t){e("setChapterIndex",t),e("setTrackTime",0)},updateTrackTime({commit:e},t){e("setTrackTime",t)},setAmplifySound({commit:e},t){e("setAmplifySound",t)},setAutoplayNextChapter({commit:e},t){e("setAutoplayNextChapter",t)},setDisplayChapterTitle({commit:e},t){e("setDisplayChapterTitle",t)},setAutoRewindOnPause({commit:e},t){e("setAutoRewindOnPause",t)},setTheme({commit:e},t){e("setTheme",t)},addBookOnShelf({getters:e,commit:t},a,r){return a||(a=e.author),a?(r||(r=e.book),r?void t("addBookOnShelf",{author:a,book:r}):null):null}},modules:{},strict:!1,plugins:[Me.plugin]}),Fe=a(8749);function Ne(e,t){const{addWarningMessage:a,clearAllMessages:r}=(0,s.g)(),{getLibraryHandle:n}=(0,L.o)(t);e.beforeEach((async(e,r)=>{await t.restored;const o=await n();if(!o&&"setup"!==e.name)return a("Library is not found, please define main directory","",!0),{name:"setup"};if(o&&"setup"!==e.name){const e=await(0,Fe.B)().hasPermission(o);if(!e)return a("Access to library is no longer granted","",!0),{name:"setup",query:{restore:!0}}}return t.getters.author&&t.getters.book||"chapter"!==e.name?void 0:(a("Your current book is not found, please choose one","",!0),{name:"book"})})),e.afterEach((()=>{r()}))}Ne(Be,We);const je=(0,r.Ef)(b).use(We).use(Be);je.mount("#app")}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,r,n,o){if(!r){var l=1/0;for(c=0;c<e.length;c++){r=e[c][0],n=e[c][1],o=e[c][2];for(var s=!0,i=0;i<r.length;i++)(!1&o||l>=o)&&Object.keys(a.O).every((function(e){return a.O[e](r[i])}))?r.splice(i--,1):(s=!1,o<l&&(l=o));if(s){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[r,n,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,r){return a.f[r](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/about.9921ebbc.js"}}(),function(){a.miniCssF=function(e){return"css/about.494528aa.css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="fable-flow:";a.l=function(r,n,o,l){if(e[r])e[r].push(n);else{var s,i;if(void 0!==o)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(i=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+o),s.src=r),e[r]=[n];var p=function(t,a){s.onerror=s.onload=null,clearTimeout(v);var n=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),n&&n.forEach((function(e){return e(a)})),t)return t(a)},v=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),i&&document.head.appendChild(s)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p=""}(),function(){if("undefined"!==typeof document){var e=function(e,t,r,n,o){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css",a.nc&&(l.nonce=a.nc);var s=function(a){if(l.onerror=l.onload=null,"load"===a.type)n();else{var r=a&&a.type,s=a&&a.target&&a.target.href||t,i=new Error("Loading CSS chunk "+e+" failed.\n("+r+": "+s+")");i.name="ChunkLoadError",i.code="CSS_CHUNK_LOAD_FAILED",i.type=r,i.request=s,l.parentNode&&l.parentNode.removeChild(l),o(i)}};return l.onerror=l.onload=s,l.href=t,r?r.parentNode.insertBefore(l,r.nextSibling):document.head.appendChild(l),l},t=function(e,t){for(var a=document.getElementsByTagName("link"),r=0;r<a.length;r++){var n=a[r],o=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(o===e||o===t))return n}var l=document.getElementsByTagName("style");for(r=0;r<l.length;r++){n=l[r],o=n.getAttribute("data-href");if(o===e||o===t)return n}},r=function(r){return new Promise((function(n,o){var l=a.miniCssF(r),s=a.p+l;if(t(l,s))return n();e(r,s,null,n,o)}))},n={524:0};a.f.miniCss=function(e,t){var a={594:1};n[e]?t.push(n[e]):0!==n[e]&&a[e]&&t.push(n[e]=r(e).then((function(){n[e]=0}),(function(t){throw delete n[e],t})))}}}(),function(){var e={524:0};a.f.j=function(t,r){var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var o=new Promise((function(a,r){n=e[t]=[a,r]}));r.push(n[2]=o);var l=a.p+a.u(t),s=new Error,i=function(r){if(a.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var o=r&&("load"===r.type?"missing":r.type),l=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+l+")",s.name="ChunkLoadError",s.type=o,s.request=l,n[1](s)}};a.l(l,i,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,o,l=r[0],s=r[1],i=r[2],u=0;if(l.some((function(t){return 0!==e[t]}))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(i)var c=i(a)}for(t&&t(r);u<l.length;u++)o=l[u],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},r=self["webpackChunkfable_flow"]=self["webpackChunkfable_flow"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=a.O(void 0,[504],(function(){return a(5351)}));r=a.O(r)})();
//# sourceMappingURL=app.3240fe28.js.map