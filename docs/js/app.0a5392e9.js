(function(){"use strict";var e={2022:function(e,t,r){r.d(t,{CV:function(){return u},HA:function(){return o},kX:function(){return n}});const n="read",o=[".mp3"],u="keiwen-fable-flow"},1178:function(e,t,r){var n=r(5130),o=r(6768),u=(r(4114),r(782)),a=r(2022);function s(){const e=(0,u.Pj)(),t=(0,o.EW)((()=>e.getters.libraryHandle));let r=!1;(0,o.wB)(t,(async e=>{e&&(r=!0,l())}));const n=async()=>{const e=[];if(!t.value)return e;try{for await(const[,r]of t.value.entries())"directory"===r.kind&&e.push(r)}catch(r){console.error("Error on authors listing:",r)}return e},s=async e=>{const t=[];if(!e)return t;try{for await(const[,r]of e.entries())"directory"===r.kind&&t.push(r)}catch(r){console.error("Error on book listing:",r)}return t},c=async e=>{const t=[];if(!e)return t;try{for await(const[r,n]of e.entries())if("file"===n.kind){const e=r.slice(r.lastIndexOf("."));a.HA.includes(e)?t.push(n):console.warn("File extension not supported: "+e)}}catch(r){console.error("Error on book listing:",r)}return t},l=async()=>{const t=await n();for(const r of t){const t={},n=await s(r);for(const e of n)t[e.name]=await c(e);e.dispatch("setAuthorBooks",{author:r.name,books:t})}r=!1};return{isLoading:r}}var c={__name:"App",setup(e){return s(),(e,t)=>{const r=(0,o.g2)("router-link"),n=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("nav",null,[(0,o.bF)(r,{to:"/setup"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)("Setup")]))),_:1}),t[4]||(t[4]=(0,o.eW)(" | ")),(0,o.bF)(r,{to:"/book"},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)("Book")]))),_:1}),t[5]||(t[5]=(0,o.eW)(" | ")),(0,o.bF)(r,{to:"/"},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)("Chapter")]))),_:1}),t[6]||(t[6]=(0,o.eW)(" | ")),(0,o.bF)(r,{to:"/settings"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)("Settings")]))),_:1})]),(0,o.bF)(n)],64)}}};const l=c;var i=l,d=r(4458);(0,d.k)("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var p=r(1387);function f(e,t,r,n,u,a){const s=(0,o.g2)("chapter-info");return(0,o.uX)(),(0,o.CE)("div",null,[t[0]||(t[0]=(0,o.Lk)("h1",null,"Play",-1)),(0,o.bF)(s)])}r(4603),r(7566),r(8721);var h=r(4232),k=r(144);const v=["src"];var b={__name:"ChapterInfo",setup(e){const t=(0,u.Pj)(),r=(0,k.KR)(null),n=(0,k.KR)(null),a=(0,o.EW)((()=>t.getters.currentAuthor)),s=(0,o.EW)((()=>t.getters.currentBook)),c=(0,o.EW)((()=>t.getters.getChaptersFromBook(a.value,s.value))),l=(0,o.EW)((()=>c.value.length)),i=(0,o.EW)((()=>t.getters.currentChapterIndex)),d=(0,o.EW)((()=>t.getters.getCurrentChapter())),p=()=>{const e=t.getters.getChapterFromBook(a.value,s.value,0);t.dispatch("updateCurrentChapterIndex",0),g(e)},f=()=>{g(d.value)},b=async()=>{const e=i.value+1,r=t.getters.getChapterFromBook(a.value,s.value,e);r&&(t.dispatch("updateCurrentChapterIndex",e),g(r))},g=async e=>{if(e)try{const t=await e.getFile();n.value&&URL.revokeObjectURL(n.value),n.value=URL.createObjectURL(t),r.value.load(),r.value.play()}catch(t){console.error("Cannot start audio file",t)}else console.error("No chapter found")};return(0,o.sV)((async()=>{r.value&&console.log("audio player initialized")})),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("p",null," Current book have "+(0,h.v_)(l.value)+" chapters ",1),(0,o.Lk)("p",null,"Current chapter is "+(0,h.v_)(d.value?d.value.name:""),1),(0,o.Lk)("p",null,[(0,o.Lk)("button",{onClick:p},"Start book over"),(0,o.Lk)("button",{onClick:f},"Resume book")]),(0,o.Lk)("div",null,[(0,o.Lk)("audio",{controls:"",ref_key:"audioPlayer",ref:r},[(0,o.Lk)("source",{src:n.value},null,8,v)],512)]),(0,o.Lk)("p",null,[(0,o.Lk)("button",{onClick:b},"Next chapter")])]))}};const g=b;var y=g,C={name:"ChapterPlayView",components:{ChapterInfo:y}},m=r(1241);const w=(0,m.A)(C,[["render",f]]);var B=w;function L(e,t,r,n,u,a){const s=(0,o.g2)("author-select"),c=(0,o.g2)("book-select");return(0,o.uX)(),(0,o.CE)("div",null,[t[0]||(t[0]=(0,o.Lk)("h1",null,"Book selection",-1)),(0,o.bF)(s),(0,o.bF)(c)])}const A=["value"];var E={__name:"AuthorSelect",setup(e){const t=(0,u.Pj)(),r=(0,k.KR)(""),a=(0,o.EW)((()=>t.getters.authorsList));return(0,o.wB)(r,(async e=>{e&&e!==t.getters.currentAuthor&&t.dispatch("updateCurrentAuthor",e)})),(0,o.sV)((async()=>{r.value=t.getters.currentAuthor})),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("p",null," Current author is set to "+(0,h.v_)(r.value),1),(0,o.Lk)("p",null,[t[1]||(t[1]=(0,o.eW)(" Select author: ")),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e)},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.value,(e=>((0,o.uX)(),(0,o.CE)("option",{key:e,value:e},(0,h.v_)(e),9,A)))),128))],512),[[n.u1,r.value]])])]))}};const F=E;var _=F;const x=["value"];var j={__name:"BookSelect",setup(e){const t=(0,u.Pj)(),r=(0,k.KR)(""),a=(0,o.EW)((()=>t.getters.currentAuthor)),s=(0,o.EW)((()=>t.getters.getBooksFromAuthor(a.value)));return(0,o.wB)(a,(async e=>{e&&(r.value=t.getters.currentBook)})),(0,o.wB)(r,(async e=>{e&&e!==t.getters.currentBook&&t.dispatch("updateCurrentBook",e)})),(0,o.sV)((async()=>{r.value=t.getters.currentBook})),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("p",null," Current book is set to "+(0,h.v_)(r.value),1),(0,o.Lk)("p",null,[t[1]||(t[1]=(0,o.eW)(" Select book: ")),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e)},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.value,(e=>((0,o.uX)(),(0,o.CE)("option",{key:e,value:e},(0,h.v_)(e),9,x)))),128))],512),[[n.u1,r.value]])])]))}};const S=j;var I=S,O={name:"BookSelectionView",components:{AuthorSelect:_,BookSelect:I}};const W=(0,m.A)(O,[["render",L]]);var P=W;const X=[{path:"/",name:"chapter",component:B},{path:"/book",name:"book",component:P},{path:"/settings",name:"settings",component:()=>r.e(594).then(r.bind(r,2131))},{path:"/setup",name:"setup",component:()=>r.e(594).then(r.bind(r,7458))}],N=(0,p.aE)({history:(0,p.LA)("/"),routes:X});var R=N,V=r(4664);const H=new V.Ay({storage:window.localStorage,key:a.CV,reducer:e=>{const{library:t,...r}=e;return r}});var K=(0,u.y$)({state:{library:{handle:null,tracks:{}},currentLibrary:"",currentAuthor:"",currentBook:"",currentChapterIndex:0},getters:{libraryHandle:e=>e.library.handle,libraryName:e=>e.library.handle?e.library.handle.name:"",currentAuthor:e=>e.currentAuthor,currentBook:e=>e.currentBook,currentChapterIndex:e=>e.currentChapterIndex,authorsList:e=>Object.keys(e.library.tracks),getBooksFromAuthor:e=>t=>e.library.tracks[t]?Object.keys(e.library.tracks[t]):[],getChaptersFromBook:e=>(t,r)=>e.library.tracks[t]&&e.library.tracks[t][r]?e.library.tracks[t][r]:[],getChapterFromBook:(e,t)=>(e,r,n)=>{const o=t.getChaptersFromBook(e,r);return o[n]?o[n]:null},getCurrentChapter:(e,t)=>()=>t.getChapterFromBook(e.currentAuthor,e.currentBook,e.currentChapterIndex)},mutations:{setLibraryHandle(e,t){e.library.handle=t,e.library.tracks={}},setCurrentLibrary(e,t){e.currentLibrary=t},setCurrentAuthor(e,t){e.currentAuthor=t},setCurrentBook(e,t){e.currentBook=t},setCurrentChapterIndex(e,t){e.currentChapterIndex=t},setAuthorBooks(e,t){e.library.tracks[t.author]=t.books},resetCurrentSelection(e){e.currentAuthor="",e.currentBook="",e.currentChapterIndex=0}},actions:{updateLibraryHandle({state:e,commit:t},r){t("setLibraryHandle",r),r?r.name!==e.currentLibrary&&(t("setCurrentLibrary",r.name),t("resetCurrentSelection")):(t("setCurrentLibrary",""),t("resetCurrentSelection"))},updateCurrentAuthor({commit:e},t){e("setCurrentBook",""),e("setCurrentChapterIndex",0),e("setCurrentAuthor",t)},updateCurrentBook({commit:e},t){e("setCurrentChapterIndex",0),e("setCurrentBook",t)},updateCurrentChapterIndex({commit:e},t){e("setCurrentChapterIndex",t)},setAuthorBooks({commit:e},t){e("setAuthorBooks",t)}},modules:{},strict:!1,plugins:[H.plugin]});const T=(0,n.Ef)(i).use(K).use(R);T.mount("#app")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return e[n].call(u.exports,u,u.exports,r),u.exports}r.m=e,function(){var e=[];r.O=function(t,n,o,u){if(!n){var a=1/0;for(i=0;i<e.length;i++){n=e[i][0],o=e[i][1],u=e[i][2];for(var s=!0,c=0;c<n.length;c++)(!1&u||a>=u)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(s=!1,u<a&&(a=u));if(s){e.splice(i--,1);var l=o();void 0!==l&&(t=l)}}return t}u=u||0;for(var i=e.length;i>0&&e[i-1][2]>u;i--)e[i]=e[i-1];e[i]=[n,o,u]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,n){return r.f[n](e,t),t}),[]))}}(),function(){r.u=function(e){return"js/about.4b825938.js"}}(),function(){r.miniCssF=function(e){}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="fable-flow:";r.l=function(n,o,u,a){if(e[n])e[n].push(o);else{var s,c;if(void 0!==u)for(var l=document.getElementsByTagName("script"),i=0;i<l.length;i++){var d=l[i];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+u){s=d;break}}s||(c=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,r.nc&&s.setAttribute("nonce",r.nc),s.setAttribute("data-webpack",t+u),s.src=n),e[n]=[o];var p=function(t,r){s.onerror=s.onload=null,clearTimeout(f);var o=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((function(e){return e(r)})),t)return t(r)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),c&&document.head.appendChild(s)}}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){r.p="/"}(),function(){var e={524:0};r.f.j=function(t,n){var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var u=new Promise((function(r,n){o=e[t]=[r,n]}));n.push(o[2]=u);var a=r.p+r.u(t),s=new Error,c=function(n){if(r.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var u=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+u+": "+a+")",s.name="ChunkLoadError",s.type=u,s.request=a,o[1](s)}};r.l(a,c,"chunk-"+t,t)}},r.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,u,a=n[0],s=n[1],c=n[2],l=0;if(a.some((function(t){return 0!==e[t]}))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);if(c)var i=c(r)}for(t&&t(n);l<a.length;l++)u=a[l],r.o(e,u)&&e[u]&&e[u][0](),e[u]=0;return r.O(i)},n=self["webpackChunkfable_flow"]=self["webpackChunkfable_flow"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=r.O(void 0,[504],(function(){return r(1178)}));n=r.O(n)})();
//# sourceMappingURL=app.0a5392e9.js.map